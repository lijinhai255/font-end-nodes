---
sidebarDepth: 2
---


# é¦–é¡µæ¨¡å—

## é¦–é¡µtabBar

### ä»£ç ä¾èµ–åˆ†æ

å¯ä»¥åœ¨åŸºæœ¬ä¿¡æ¯ä¸­é€‰æ‹©ä»£ç ä¾èµ–åˆ†æ

<img src="./assets/image-20210428193747590.png" width="400"/>

æŸ¥çœ‹æœ¬åœ°ä»£ç ä¸åˆ†åŒ…å¤§å°ï¼š

<img src="./assets/image-20210428193958813.png" width="800"/>


### å¯¼å…¥é™æ€èµ„æº

- åˆ é™¤åŸ`static`ç›®å½•ä¸­çš„æ–‡ä»¶ï¼›
- ä¸‹è½½è¯¾ç¨‹çš„é™æ€èµ„æºæ–‡ä»¶å¤¹ï¼Œå¹¶æ”¾ç½®äº`static`çš„`images`ç›®å½•ä¸­ã€‚

### å¸ƒå±€ä¸æ ·å¼

å®Œæˆæ•ˆæœï¼š

<img src="./assets/image-20210428194953556.png" width="300"/>

åˆ›å»ºtabBarçš„æ­¥éª¤ï¼š

- åˆ›å»ºtabBarå¯¹åº”çš„é¡µé¢ï¼›
- ä¿®æ”¹pages.jsonä¸­çš„é…ç½®é¡¹ï¼š`pages`å’Œ`tabBar`



åˆ›å»ºé¡µé¢HBuilderxæ–¹å¼ï¼š

<img src="./assets/image-20210419173303417.png" width="600"/>


åˆ›å»ºé¡µé¢çš„VSCodeæ’ä»¶æ–¹å¼ï¼š

![image-20210428194346415](./assets/image-20210428194346415.png)



å¿«é€Ÿåˆ›å»º4ä¸ªé¡µé¢

![image-20210428194614781](./assets/image-20210428194614781.png)

å¹¶è°ƒæ•´`pages.json`ï¼š

```json
{
	"pages": [
		{
			"path": "pages/home/home"
		},
		{
			"path": "pages/msg/msg"
		},
		{
			"path": "pages/hot/hot"
		},
		{
			"path": "pages/center/center"
		}
	],
	"globalStyle": {
		"navigationBarTextStyle": "black",
		"navigationBarTitleText": "uni-app",
		"navigationBarBackgroundColor": "#F8F8F8",
		"backgroundColor": "#F8F8F8",
		"app-plus": {
			"background": "#efeff4"
		}
	}
}
```

æ–°å»ºtabBarå±æ€§ï¼š

```json
"tabBar": {
	"color": "#999",
	"backgroundColor": "#fafafa",
	"selectedColor": "#02D199",
	"borderStyle": "white",
	"list": [
		{
			"text": "é¦–é¡µ",
			"pagePath": "pages/home/home",
			"iconPath": "static/images/tab_home_no.png",
			"selectedIconPath": "static/images/tab_home_yes.png"
		},
		{
			"text": "æ¶ˆæ¯",
			"pagePath": "pages/msg/msg",
			"iconPath": "static/images/tab_news_no.png",
			"selectedIconPath": "static/images/tab_news_yes.png"
		},
		{
			"text": "çƒ­é—¨",
			"pagePath": "pages/hot/hot",
			"iconPath": "static/images/tab_popular_no.png",
			"selectedIconPath": "static/images/tab_popular_yes.png"
		},
		{
			"text": "æˆ‘çš„",
			"pagePath": "pages/center/center",
			"iconPath": "static/images/tab_my_no.png",
			"selectedIconPath": "static/images/tab_my_yes.png"
		}
	],
	"position": "bottom"
}
```



åº•éƒ¨çš„é˜´å½±ï¼š

```vue
<view class="bottom-line"></view>

<style lang="scss">
.bottom-line {
  position: fixed;
  bottom: -5px;
  left: 0;
  width: 100vw;
  height: 5px;
  background: transparent;
  box-shadow: 0 -5px 5px rgba(0, 0, 0, 0.05);
}
</style>
```



### å¯¼å…¥uView UI

å‡†å¤‡å·¥ä½œ

```js
// å®‰è£…sassä¾èµ–
npm i node-sass sass-loader@10 -D

// å®‰è£…uView
npm install uview-ui
```



åœ¨`main.js`ä¸­å¼•å…¥ï¼š

```
import uView from 'uview-ui'
Vue.use(uView)
```



åœ¨é¡¹ç›®æ ¹ç›®å½•çš„`uni.scss`ä¸­å¼•å…¥æ ·å¼æ–‡ä»¶ï¼š

```css
/* uni.scss */
@import 'uview-ui/theme.scss';
```



è°ƒæ•´`App.vue`çš„æ ·å¼

```vue
<style lang="scss">
/* æ³¨æ„è¦å†™åœ¨ç¬¬ä¸€è¡Œï¼ŒåŒæ—¶ç»™styleæ ‡ç­¾åŠ å…¥lang="scss"å±æ€§ */
@import "uview-ui/index.scss";
</style>
```



é…ç½®`pages.json`ï¼š

```json
	// ....
	"easycom": {
		"^u-(.*)": "uview-ui/components/u-$1/u-$1.vue"
	}
```



## æœç´¢

### æ·»åŠ åˆ†åŒ…

åœ¨uniappä¸­æ·»åŠ åˆ†åŒ…

- æ–°å¢é¡µé¢ï¼Œæ¯”å¦‚`/sub-pkg/search/search`
- é…ç½®`pages.json`



### å¸ƒå±€ä¸æ ·å¼

```vue
<template>
  <view class="search">
    <div class="search-box">
      <u-search :focus="true"></u-search>
    </div>
    <!-- æœç´¢å»ºè®®åˆ—è¡¨ -->
    <view class="list" v-if="searchResults.length !== 0">
      <view class="item" v-for="(item, i) in searchResults" :key="i">
        <view class="name">{{item.name}}</view>
        <u-icon type="arrow-right" size="16"></u-icon>
      </view>
    </view>
    <!-- æœç´¢å†å² -->
    <view class="history-box" v-else>
      <!-- æ ‡é¢˜åŒºåŸŸ -->
      <view class="history-title" v-if="historyList.length !== 0">
        <text>æœç´¢å†å²</text>
        <u-icon type="trash" size="17" @click="clean"></u-icon>
      </view>
      <!-- åˆ—è¡¨åŒºåŸŸ -->
      <view class="history-list">
        <uni-tag :text="item" v-for="(item, i) in historyList" :key="i"></uni-tag>
      </view>
    </view>
    <!-- çƒ­é—¨æ¨è -->
    <view class="history-box">
      <!-- æ ‡é¢˜åŒºåŸŸ -->
      <view class="history-title" v-if="hotList.length !== 0">
        <text>çƒ­é—¨æ¨è</text>
      </view>
      <!-- åˆ—è¡¨åŒºåŸŸ -->
      <view class="history-list">
        <uni-tag :text="item" v-for="(item, i) in hotList" :key="i"></uni-tag>
      </view>
    </view>
  </view>
</template>

<style lang="scss" scoped>
.search {
  padding: 24rpx;
}

.search-box {
  position: sticky;
  top: 0;
  z-index: 999;
  padding-bottom: 50rpx;
}

.list {
  padding: 0 5px;
  .item {
    font-size: 12px;
    padding: 13px 0;
    border-bottom: 1px solid #efefef;
    display: flex;
    align-items: center;
    justify-content: space-between;
    .name {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      margin-right: 3px;
    }
  }
}

.history-box {
  padding: 0 10rpx 50rpx;

  .history-title {
    display: flex;
    justify-content: space-between;
    align-items: center;
    height: 40px;
    font-size: 16px;
    font-weight: bold;
  }

  .history-list {
    display: flex;
    flex-wrap: wrap;
    ::v-deep .uni-tag {
      margin-top: 5px;
      margin-right: 5px;
      border-radius: 25rpx;
    }
  }
}
</style>
```



`pages.json`ä¸­é…ç½®åˆ†åŒ…ï¼š

```json
"subPackages": [
	{
		"root": "subpkg",
		"pages": [
			{
				"path": "search/search",
				"style": {
					"navigationBarTitleText": "æœç´¢"
				}
			},
      // ...
    ]
  }
]
```



ä½¿ç”¨easycomï¼Œæ·»åŠ `search.vue`ç»„ä»¶ï¼š

```vue
<template>
  <view :style="{'padding-top': barHeight + 'px'}" class="search" @click="$emit('click')">
    <view class="search-box">
      <u-icon name="search" color="#CCCCCC" size="28" class="icon"></u-icon>
      <text>æœç´¢ç¤¾åŒºå†…å®¹</text>
    </view>
  </view>
</template>

<script>

export default {
  props: {},
  data: () => ({
    barHeight: 80
  }),
  computed: {},
  methods: {
    getNavBarHeight () {
      uni.getSystemInfo({
        success: (result) => {
          const statusBarHeight = result.statusBarHeight
          const isiOS = result.system.indexOf('iOS') > -1
          if (isiOS) {
            this.barHeight = statusBarHeight + 5
          } else {
            this.barHeight = statusBarHeight + 7
          }
          // getApp().globalData.barHeight = this.barHeight
          // å­˜å‚¨è‡³storeä¸­
          // uni.setStorage({
          //   key: 'setBarHeight',
          //   data: this.barHeight
          // })
        },
        fail: () => {},
        complete: () => {}
      })
    }
  },
  beforeMount () {
    this.getNavBarHeight()
  }
}
</script>

<style lang="scss" scoped>
// search
.search {
  // padding-top: 25px;
  position: relative;
  background: #fff;
  width: 100vw;
  padding: 0 32rpx 12rpx;
  z-index: 999;
  .search-box {
    position: relative;
    width: 70%;
    @media (max-width: 320px) {
      width: 60%;
    }
    height: 64rpx;
    line-height: 64rpx;
    background: #f3f3f3;
    border-radius: 32rpx;
    color: #ccc;
    font-size: 26rpx;
    padding-left: 74rpx;
  }
  .icon {
    position: absolute;
    left: 32rpx;
    top: 19rpx;
  }
}
</style>
```



`home.vue`æ·»åŠ å¯¼èˆªï¼š

```vue
<search @click="gotoSearch"></search>
```



å®Œæˆæ•ˆæœï¼š

![image-20210523231442459](./assets/image-20210523231442459.png)

### æ·»åŠ äº‹ä»¶



`home.vue`æ·»åŠ `gotoSearch`æ–¹æ³•ï¼Œå®Œæˆé¡µé¢è·³è½¬ã€‚

```javascript
gotoSearch () {
  uni.navigateTo({
    url: '/subcom-pkg/search/search'
  })
}
```



å®Œæˆæ•ˆæœï¼š

![iShot2021-05-23 23.36.17](./assets/iShot2021-05-23 23.36.17.gif)

## é¦–é¡µTabs

### å¸ƒå±€ä¸æ ·å¼

`home.vue`æ·»åŠ tabs

```vue
<u-tabs ref="uTabs" :is-scroll="true" active-color="#02D199" height="88" gutter="50"></u-tabs>
```



æ·»åŠ tabsæ•°æ®

```vue
<u-tabs ref="uTabs" :list="tabs" :name="'value'" :current="current" :is-scroll="true" active-color="#02D199" height="88" gutter="50"></u-tabs>
<script>
  export default {
  data: () => ({
    tabs: [
      {
        key: '',
        value: 'é¦–é¡µ'
      },
      {
        key: 'ask',
        value: 'æé—®'
      },
      {
        key: 'share',
        value: 'åˆ†äº«'
      },
      {
        key: 'discuss',
        value: 'è®¨è®º'
      },
      {
        key: 'advise',
        value: 'å»ºè®®'
      },
      {
        key: 'advise',
        value: 'å…¬å‘Š'
      },
      {
        key: 'advise',
        value: 'åŠ¨æ€'
      }
    ],
    // å› ä¸ºå†…éƒ¨çš„æ»‘åŠ¨æœºåˆ¶é™åˆ¶ï¼Œè¯·å°†tabsç»„ä»¶å’Œswiperç»„ä»¶çš„currentç”¨ä¸åŒå˜é‡èµ‹å€¼
    current: 0, // tabsç»„ä»¶çš„currentå€¼ï¼Œè¡¨ç¤ºå½“å‰æ´»åŠ¨çš„tabé€‰é¡¹
    swiperCurrent: 0, // swiperç»„ä»¶çš„currentå€¼ï¼Œè¡¨ç¤ºå½“å‰é‚£ä¸ªswiper-itemæ˜¯æ´»åŠ¨çš„
  })
}
</script>
```



å®Œæˆæ•ˆæœ

![image-20210526225831609](./assets/image-20210526225831609.png)



### æ·»åŠ äº‹ä»¶

tabsæ·»åŠ åˆ‡æ¢äº‹ä»¶`tabsChange`

```vue
<u-tabs ref="uTabs" :list="tabs" :name="'value'" :current="current" @change="tabsChange" :is-scroll="true" active-color="#02D199" height="88" gutter="50"></u-tabs>

<script>
	export default {
    ...
    methods: {
      // tabsé€šçŸ¥swiperåˆ‡æ¢
      tabsChange (index) {
        this.current = index
      }
    }
  }
</script>
```



## å†…å®¹åˆ—è¡¨

### å¸ƒå±€ä¸æ ·å¼

æ·»åŠ `list-item`ç»„ä»¶

```vue
<template>
  <view class="list-item">
    <view class="list-head">
      <view class="title">
        <text class="ellipsis"><text class="type" :class="['type-'+item.catalog]" v-if="item.catalog === 'share'">åˆ†äº«</text>
          <text class="type" :class="['type-'+item.catalog]" v-else-if="item.catalog === 'ask'">æé—®</text>
          <text class="type" :class="['type-'+item.catalog]" v-else-if="item.catalog === 'discuss'">è®¨è®º</text>
          <text class="type" :class="['type-'+item.catalog]" v-else-if="item.catalog === 'advise'">å»ºè®®</text>
          {{item.title}}
        </text>
      </view>
    </view>
    <view class="author">
      <view class="inline-block flex-left-center">
        <u-image class="head" :src="item.uid.pic" width="40" height="40" shape="circle" error-icon="/static/images/header.jpg">
        </u-image>
        <text class="name">{{item.uid.name || 'æœªçŸ¥ç”¨æˆ·'}}</text>
        <view class="vip" v-show="item.uid.isVip !== '0'">VIP{{item.uid.isVip}}</view>
      </view>
    </view>
    <view class="list-body">
      <view class="info">{{item.content}}</view>
      <image class="fmt" :src="item.snapshot" v-show="item.snapshot" />
    </view>
    <view class="list-footer">
      <view class="left">
        <text class="reply-num">{{item.answer}} å›å¤</text>
        <text class="timer">{{item.created | moment}}</text>
      </view>
    </view>
  </view>
</template>

<script>

export default {
  props: {
    item: {
      type: Object,
      default: () => ({})
    }
  },
  data: () => ({})
}
</script>

<style></style>
```



`home.vue`æ·»åŠ å†…å®¹å±•ç¤ºåŒº

```vue
<view class="content" :style="{'padding-top': offsetTop + 'px'}">
  <view class="wrapper">
    <view v-for="(item,index) in finalList" :key="index" class="list-box" @click="gotoDetail(item)">
      <list-item :item="item"></list-item>
    </view>
  </view>
</view>

<script>
export default {
  data: () => ({
    ...
    offsetTop: 50,
    lists: [],
    page: {
      page: 0,
      limit: 10,
      catagory: '',
      sort: 'created'
    },
    loading: false
  })
}
</script>
```



æ·»åŠ å†…å®¹åŒºåŸŸæ ·å¼

```css
// content lists
.content {
  background: #f5f6f7;
  .wrapper {
    padding: 24rpx 0;
  }
  // .nomore {
  //   text-align: center;
  //   padding: 15px 0 25px 0;
  //   color: #999;
  //   font-size: 24rpx;
  // }
}
.list-box {
  padding: 30rpx;
  background-color: #fff;
  margin-bottom: 20rpx;
}
.list-head {
  /*  display: flex;
  align-items: center; */
  margin-bottom: 18rpx;
  .type {
    display: inline-block;
    height: 36rpx;
    width: 72rpx;
    text-align: center;
    line-height: 36rpx;
    white-space: nowrap;
    margin-right: 10rpx;
    font-size: 24rpx;
    border-radius: 18rpx;
    border-bottom-left-radius: 0;
    color: #fff;
  }
  .type-share {
    background-color: #feb21e;
  }
  .type-ask {
    background-color: #02d199;
  }
  .type-discuss {
    background-color: #fe1e1e;
  }
  .type-advise {
    background-color: #0166f8;
  }
  .title {
    color: #333;
    font-size: 32rpx;
    line-height: 44rpx;
    font-weight: bold;
    .ellipsis {
      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
    }
    .type {
      min-width: 40rpx;
      transform: scale(0.9);
      position: relative;
      top: -4rpx;
      align-self: flex-start;
    }
  }
}
.author {
  display: flex;
  align-items: center;
  font-size: 24rpx;
  margin-right: 30rpx;
  margin-bottom: 18rpx;
  color: #666;
  .head {
    margin-right: 10rpx;
  }
}
.list-body {
  margin-bottom: 30rpx;
  display: flex;
  .info {
    font-size: 28rpx;
    color: #666;
    max-height: 94rpx;
    flex: 1;
    margin-right: 20rpx;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
  }
  .fmt {
    width: 192rpx;
    height: 122rpx;
    border-radius: 8rpx;
  }
}

.list-footer {
  color: #999;
  font-size: 24rpx;
  display: flex;
  align-items: center;
  .left {
    flex: 1;
    display: flex;
    align-items: center;
    .svg-icon {
      margin-right: 5rpx;
    }
    .timer {
      margin-left: 20rpx;
    }
  }
}
```



ç›‘å¬é¡µé¢åŠ è½½ï¼Œå¤„ç†å†…å®¹åˆ—è¡¨å®¹å™¨çš„padding

```javascript
onLoad () {
  const query = uni.createSelectorQuery().in(this)
  query.select('.fixed-top').boundingClientRect(data => {
    this.offsetTop = data.height
  }).exec()
  // const { windowHeight } = uni.getSystemInfoSync()
  // const query = uni.createSelectorQuery().in(this)
  // query.select('#tabs').boundingClientRect(data => {
  // }).exec()
}
```



### è·å–æ•°æ®

åœ¨é€šè¿‡åå°æ¥å£è·å–æ•°æ®å‰ï¼Œæˆ‘ä»¬éœ€è¦å¯¹requestå’Œapiè¿›è¡Œç®€å•çš„å°è£…ã€‚

åˆ›å»º`common`æ–‡ä»¶å¤¹ï¼Œæ–°å»º request.js

```javascript
// console.log(process.env)

export const config = {
  baseUrl: 'https://mp.toimc.com', // è¯·æ±‚çš„æœ¬åŸŸå
  // è®¾ç½®ä¸ºjsonï¼Œè¿”å›åä¼šå¯¹æ•°æ®è¿›è¡Œä¸€æ¬¡JSON.parse()
  dataType: 'json',
  showLoading: true, // æ˜¯å¦æ˜¾ç¤ºè¯·æ±‚ä¸­çš„loading
  loadingText: 'è¯·æ±‚ä¸­...', // è¯·æ±‚loadingä¸­çš„æ–‡å­—æç¤º
  loadingTime: 800, // åœ¨æ­¤æ—¶é—´å†…ï¼Œè¯·æ±‚è¿˜æ²¡å›æ¥çš„è¯ï¼Œå°±æ˜¾ç¤ºåŠ è½½ä¸­åŠ¨ç”»ï¼Œå•ä½ms
  originalData: false, // æ˜¯å¦åœ¨æ‹¦æˆªå™¨ä¸­è¿”å›æœåŠ¡ç«¯çš„åŸå§‹æ•°æ®
  loadingMask: true, // å±•ç¤ºloadingçš„æ—¶å€™ï¼Œæ˜¯å¦ç»™ä¸€ä¸ªé€æ˜çš„è’™å±‚ï¼Œé˜²æ­¢è§¦æ‘¸ç©¿é€
  // é…ç½®è¯·æ±‚å¤´ä¿¡æ¯
  header: {
    'content-type': 'application/json;charset=UTF-8'
  }
}

const install = (Vue) => {
  const http = Vue.prototype.$u.http
  http.setConfig(config)

  http.interceptor.request = (config) => {
    console.log('ğŸš€ ~ file: request.js ~ line 24 ~ install ~ config', config)

    // å¯ä»¥å¯¹æŸä¸ªurlè¿›è¡Œç‰¹åˆ«å¤„ç†ï¼Œæ­¤urlå‚æ•°ä¸ºthis.$u.get(url)ä¸­çš„urlå€¼
    // æœ€åéœ€è¦å°†configè¿›è¡Œreturn
    return config
    // å¦‚æœreturnä¸€ä¸ªfalseå€¼ï¼Œåˆ™ä¼šå–æ¶ˆæœ¬æ¬¡è¯·æ±‚
    // if(config.url == '/user/rest') return false; // å–æ¶ˆæŸæ¬¡è¯·æ±‚
  }

  http.interceptor.response = (data) => {
    console.log('ğŸš€ ~ file: request.js ~ line 46 ~ install ~ data', data)
    return data
  }
}

export default {
  install
}
```



åˆ›å»º`api`æ–‡ä»¶å¤¹ï¼Œæ–°å»º index.jsï¼ŒæŒ‰æ¨¡å—è¿›è¡Œæ¥å£åˆ’åˆ†

![image-20210526235920712](./assets/image-20210526235920712.png)

index.js

```javascript
const req = require.context('./modules', false, /\.js$/)
// console.log('ğŸš€ ~ file: index.js ~ line 2 ~ req', req)

const install = (Vue) => {
  const http = Vue.prototype.$u.http
  req.keys().forEach(item => {
    const module = req(item)
    const keys = Object.keys(module)
    keys.forEach(key => {
      http.api = {
        ...http.api,
        [key]: module[key]
      }
    })
  })
}

export default {
  install
}
```

public.js

```javascript
import Vue from 'vue'

const HttpRequest = Vue.prototype.$u

// ---------------------------------------é¦–é¡µ----------------------------------------- //
// è·å–é¦–é¡µåˆ—è¡¨æ•°æ®
export const getContentList = params => HttpRequest.get('/public/list', params)
```



åœ¨`main.js`ä¸­å¼•å…¥

```javascript
import apis from '@/api/index'
import interceptors from '@/common/request'

Vue.use(interceptors)
Vue.use(apis)
```



ä¸‹é¢æˆ‘ä»¬æ¥è·å–é¦–é¡µåˆ—è¡¨æ•°æ®ï¼Œåˆ›å»º`getList`æ–¹æ³•

```javascript
async getList () {
  this.loading = true
  try {
    const { data } = await this.$u.http.api.getContentList(this.page)
    this.lists = data
  } finally {
    this.loading = false
  }
}
```



é€šè¿‡è®¡ç®—å±å¯¹åˆ—è¡¨æ•°æ®ä¸­çš„å¤´åƒè¿›è¡Œå¤„ç†

```javascript
computed: {
  finalList () {
    return this.lists.map(item => {
      if (!item.pic) {
        if (item.uid && item.uid.pic) {
          // ç½‘ç»œå›¾ç‰‡ -> httpsï¼ŒæœåŠ¡å™¨çš„å›¾ç‰‡ -> /img/
          if (!item.uid.pic.startsWith('http')) {
            item.pic = config.baseUrl + item.uid.pic
          } else {
            // è¿™æ˜¯ä¸€å¼ ç½‘ç»œå›¾ç‰‡
            item.pic = item.uid.pic
          }
        } else {
          // é»˜è®¤å¦‚æœæœªè®¾ç½®pic
          item.pic = '/static/images/header.jpg'
        }
      }
      return item
    })
  }
}
```



æœ€ååœ¨`onshow`å‘¨æœŸè¯·æ±‚æ•°æ®

```javascript
onShow () {
    this.getList()
}
```



å®Œæˆæ•ˆæœï¼š

![image-20210527003502507](./assets/image-20210527003502507.png)

### åˆ†é¡µä¸åˆ‡æ¢

ä¸Šæ‹‰åˆ†é¡µåŠ è½½åˆ—è¡¨æ•°æ®

```javascript
// é¡µé¢å¤„ç†å‡½æ•°--ç›‘å¬ç”¨æˆ·ä¸Šæ‹‰è§¦åº•
async onReachBottom () {
  if (this.loading) return
  this.page.page++
  const { data } = await this.$u.http.api.getContentList(this.page)
  this.lists = [...this.lists, ...data]
}
```



åŒæ—¶åœ¨tabåˆ‡æ¢æ—¶åŠ è½½ä¸åŒåˆ†ç±»çš„æ•°æ®ï¼Œåœ¨tabsåˆ‡æ¢æ–¹æ³•`tabsChange`ä¸­æ·»åŠ  getList æ–¹æ³•

```javascript
tabsChange (index) {
  this.current = index
  this.page = {
    page: 0,
    limit: 10,
    catalog: this.tabs[this.current].key || '',
    sort: 'created'
  }
  this.getList()
}
```



## å‘å¸–å…¥å£

### å¸ƒå±€ä¸æ ·å¼

åœ¨`home.vue`æ·»åŠ å‘å¸–å…¥å£

```vue
<image class="add-post" src="/static/images/add-post.png" />
```



ä¿®æ”¹`add-post`æ ·å¼

```css
.add-post {
  position: fixed;
  width: 150rpx;
  height: 150rpx;
  bottom: 30rpx;
  right: 10rpx;
  z-index: 999;
}
```



å®Œæˆæ•ˆæœ

![image-20210527004752928](./assets/image-20210527004752928.png)

### æ·»åŠ äº‹ä»¶

æ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼Œç‚¹å‡»è·³è½¬å‘å¸–é¡µé¢

```javascript
newContent () {
  uni.navigateTo({
    url: '/subcom-pkg/post/post'
  })
}
```

## é¦–é¡µ 

```js
<template>
	<view id="index">

		<!-- é¡¶éƒ¨å¯¼èˆª -->
		<uni-nav-bar v-if="navBarShowTag">
			<view class="tabs-box">
				<view class="one-nav" :class="currentSwiperIndex === 0 ? 'nav-actived' : '' " @tap="swiperChange(0)">æ¨è</view>
				<view class="one-nav" :class="currentSwiperIndex === 1 ? 'nav-actived' : '' " @tap="swiperChange(1)">èµ„è®¯</view>
			</view>
		</uni-nav-bar>

		<!-- é¡µé¢ header ç›¸å…³éƒ¨åˆ† -->
		<view class="header-box">
			<!-- é¡¶éƒ¨å¹¿å‘Šä½è½®æ’­<strong></strong>å›¾ -->
			<swiper class="swiper" :indicator-dots="false" :autoplay="true" :interval="2500" :duration="500">
				<swiper-item v-for="item in swiperAdList" :key="item.id">
					<navigator open-type="navigate" :url=" '/pages/webview/webview?url='+item.link">
						<image class="banner-swiper-img" :src="item.image" mode="aspectFill" />
					</navigator>
				</swiper-item>
			</swiper>
			<!-- é®ç½©ä½¿ç”¨å¼§å½¢æ¡† -->
			<image class="crile" src="@/static/crile.png" mode="aspectFill" />
			<!-- ä¸¤ä¸ªé€‰é¡¹æŒ‰é’® -->
			<view class="card-header">
				<view class="card-one card-left" @tap="gotoFeeds('/pages/feeds/feeds')">
					<image class="img" src="@/static/coffee.png" mode="aspectFill" />
					<view class="iright">
						<view class="title">ç²¾å½©åŠ¨æ€</view>
					</view>
				</view>
				<view class="card-one card-right" @tap="gotoFeeds('/pages/me/me')">
					<image class="img" src="@/static/ran.png" mode="aspectFill" />
					<view class="iright">
						<view class="title">ä¸ªäººä¸­å¿ƒ</view>
					</view>
				</view>
			</view>

			<!-- Tab é€‰é¡¹å¡ -->
			<view class="tabs-box">
				<view class="one-nav" :class="currentSwiperIndex === 0 ? 'nav-actived' : '' " @tap="swiperChange(0)">æ¨è</view>
				<view class="one-nav" :class="currentSwiperIndex === 1 ? 'nav-actived' : '' " @tap="swiperChange(1)">èµ„è®¯</view>
			</view>

		</view>

		<!-- å†…å®¹è½®æ’­å¯¼èˆªå®ç° -->
		<swiper class="swiper-box" :style=" 'height:'+ swiperSliderHeight " :current="currentSwiperIndex" @animationfinish="swiperSlider">
			<!-- æ¨èåŠ¨æ€å®ç° -->
			<swiper-item class="swiper-item">
				<view class="page-item sns-now">
					<view class="feeds-box">
						<waterfall-sns v-model="feedsList" ref="waterfall">
							<template v-slot:left="{leftList}">
								<view class="feed-one" v-for="(item, index) in leftList" :key="index">
									<navigator open-type="navigate" :url=" '/subpages/feedinfo/feedinfo?id=' + item.id">
										<image class="feed-img" :src="item.cover" mode="widthFix" :lazy-load="true" />
										<view class="u-line-2 feed-title" v-if="!!item.feed_content">{{ item.feed_content }}</view>
										<view class="feed-info">
											<view class="iview">
												<image class="avatar" :src=" item.avatar" />
												<text class="name u-line-1">{{ item.name }}</text>
											</view>
											<view class="iview">
												<view class="ilike" @tap.stop="clickLove(item)">
													<image v-if="item.has_like" src="@/static/lover.png" class="micon" />
													<image v-else src="@/static/love.png" class="micon" />
													<text class="love-count" v-if="item.like_count>0">{{ item.like_count }}</text>
												</view>
											</view>
										</view>
									</navigator>
								</view>
							</template>
							<template v-slot:right="{rightList}">
								<view class="feed-one" v-for="(item, index) in rightList" :key="index">
									<navigator open-type="navigate" :url=" '/subpages/feedinfo/feedinfo?id=' + item.id">
										<image class="feed-img" :src="item.cover" mode="widthFix" :lazy-load="true" />
										<view class="u-line-2 feed-title" v-if="!!item.feed_content">{{ item.feed_content }}</view>
										<view class="feed-info">
											<view class="iview">
												<image class="avatar" :src=" item.avatar" />
												<text class="name u-line-1">{{ item.name }}</text>
											</view>
											<view class="iview">
												<view class="ilike" @tap.stop="clickLove(item)">
													<image v-if="item.has_like" src="@/static/lover.png" class="micon" />
													<image v-else src="@/static/love.png" class="micon" />
													<text class="love-count" v-if="item.like_count>0">{{ item.like_count }}</text>
												</view>
											</view>
										</view>
									</navigator>
								</view>
							</template>
						</waterfall-sns>
					</view>
				</view>
			</swiper-item>
			<!-- èµ„è®¯åˆ—è¡¨å®ç° -->
			<swiper-item class="swiper-item sns-news">
				<view v-for="(item, index) in newsList" :key="index">
					<navigator class="one-new" open-type="navigate" :url=" '/subpages/newinfo/newinfo?id=' + item.id">
						<view class="left">
							<view class="title u-line-2">{{item.title}}</view>
							<view class="uinfo">
								<view class="iview">
									<view class="utime">
										<text class="name">{{ item.author }}</text>
									</view>
								</view>
								<text class="uptime">{{ item.created_at | timeFormate }}å‘å¸ƒ</text>
							</view>
						</view>
						<view class="right">
							<image class="pic" mode="aspectFill" :src="item.cover" />
						</view>
					</navigator>
				</view>
			</swiper-item>

		</swiper>

		<!-- åˆ†äº«æŒ‰é’®ç»„ä»¶ -->
		<goto-share />

		<!-- ç™»é™†ç»„ä»¶ -->
		<login ref="login" />

	</view>
</template>

<script>
	import {
		mapState,
		mapActions
	} from 'vuex'
	// å¼•å…¥ æ—¶é—´æ—¥æœŸæ ¼å¼åŒ–æ˜¾ç¤ºå‡½æ•°
	import timeFrom from '@/tools/timeFrom.js'
	// å¼•å…¥ ä¸ªæ€§åŒ– ç€‘å¸ƒæµç»„ä»¶
	import WaterfallSns from '@/components/waterfall-sns/index.vue'
	import feedMixin from '@/mixins/todoFeed.js'
	export default {
		mixins: [feedMixin],
		data() {
			return {
				// navBar æ˜¾ç¤ºçŠ¶æ€æ§åˆ¶
				navBarShowTag: false,
				// é¡¶éƒ¨ è½®æ’­å›¾åˆ—è¡¨
				swiperAdList: [],
				// åŠ¨æ€åˆ—è¡¨æ•°æ®
				feedsList: [],
				// èµ„è®¯åˆ—è¡¨æ•°æ®
				newsList: [],
				// å½“å‰ æ¨è èµ„è®¯ æ»‘åŠ¨ä½ç½®
				currentSwiperIndex: 0,
				// æ»‘åŠ¨é¡µé¢è½®æ’­å™¨çš„é«˜åº¦
				swiperSliderHeight: '500px',
				swiperSliderFeedsHeight: 0,
				swiperSliderNewsHeight: 0,
				// è®°å½•æ»šåŠ¨æ‰€åœ¨çš„ä½ç½®
				oldFeedsScrollTop: 0,
				oldNewsScrollTop: 0
			}
		},
		components: {
			WaterfallSns
		},
		computed: {
			...mapState(['loginState', 'userInfo'])
		},
		async onLoad() {
			
			uni.$on('indexUserLogin', ()=>{
				this.currentSwiperIndex = 0
				this.feedsList = []
				this.$refs.waterfall.clear()
				this.getFeedsList()
			})
			uni.$on('indexUserLogout', ()=>{
				this.currentSwiperIndex = 0
				this.feedsList = []
				this.$refs.waterfall.clear()
				this.getFeedsList()
			})
			
			// å‘å¸ƒæ–°çš„åŠ¨æ€åï¼Œè§¦å‘æ•°æ®æ›´æ–°
			uni.$on("indexFeedsUpdate", ()=>{
				this.currentSwiperIndex = 0
				this.feedsList = []
				this.$refs.waterfall.clear()
				this.getFeedsList()
			})
			
			// ä¸ªäººä¸­å¿ƒåˆ é™¤ä¸€æ¡åŠ¨æ€åï¼Œè§¦å‘æ›´æ–°é¦–é¡µæ•°æ®
			uni.$on("indexFeedRemove", fid =>{
				this.$refs.waterfall.remove(fid);
			})
			
			// ç”¨æˆ·ç‚¹èµä¸€æ¡åŠ¨æ€åè§¦å‘æ•°æ®æ›´æ–°
			uni.$on('indexFeedLoveChange', item => {
				this.$refs.waterfall.modify(item.id, "like_count", item.like_count);
				this.$refs.waterfall.modify(item.id, "has_like", item.has_like);
			})

			// æˆ‘ä»¬è¦åœ¨è¿™é‡Œåˆå§‹åŒ–è¯·æ±‚ç›¸å…³æ•°æ®
			this.getAdverts()
			this.getFeedsList()
			this.getNewsList()

		},
		onPageScroll(event) {
			if (this.currentSwiperIndex === 0) {
				this.oldFeedsScrollTop = event.scrollTop
			} else {
				this.oldNewsScrollTop = event.scrollTop
			}
			if (event.scrollTop > 220) {
				this.navBarShowTag = true
			} else {
				this.navBarShowTag = false
			}
		},
		onReachBottom() {
			console.log('ä¸‹æ‹‰åˆ°åº•å•¦')
			// è¯·æ±‚æ–°çš„æ•°æ®
			if (this.currentSwiperIndex === 0) {
				this.getFeedsList()
			} else {
				this.getNewsList()
			}
		},
		onPullDownRefresh() {
			console.log('é¡¶éƒ¨ä¸‹æ‹‰åˆ·æ–°')
			this.feedsList = []
			this.$refs.waterfall.clear()
			if (this.currentSwiperIndex === 0) {
				this.getFeedsList()
			} else {
				this.getNewsList()
			}
		},
		filters: {
			timeFormate(timeDate) {
				let Time = new Date(timeDate);
				let timestemp = Time.getTime();
				let t = timeFrom(timestemp, "yyyyå¹´mmæœˆddæ—¥");
				return t;
			}
		},
		methods: {
			// è¯·æ±‚ å¹¿å‘Šè½®æ’­å›¾ä¿¡æ¯
			async getAdverts() {
				let adverts = await this.$u.api.getAdvert({
					space: '1,2,3'
				})
				this.swiperAdList = adverts.data.map(item => {
					return {
						id: item.id,
						link: item.data.link,
						image: item.data.image
					}
				})
			},
			// è¯·æ±‚ feeds åˆ—è¡¨æ•°æ®
			async getFeedsList() {
				let feeds = await this.$u.api.getFeeds()
				let feedList = feeds.data.feeds.map(item => {
					return {
						...item,
						cover: this.BaseFileURL + item.images[0].file,
						avatar: !!item.user.avatar ? item.user.avatar.url : '/static/nopic.png',
						name: item.user.name,
					}
				})
				this.feedsList = [...this.feedsList, ...feedList]
				// åœ¨è¿™é‡Œæ³¨å†Œä¸€ä¸ª uniAPP çš„é¡¶å±‚äº‹ä»¶ï¼Œç”¨æ¥ä½œä¸ºæ•°æ®é€šä¿¡
				uni.$once("swiperHeightChange", height => {
					console.log('è®¡ç®—å‡ºæ¥çš„é«˜åº¦ä¸º:'+ height)
					this.swiperSliderFeedsHeight = height
					this.swiperSliderHeight = height
				})
			},
			// è¯·æ±‚èµ„è®¯åˆ—è¡¨æ•°æ®
			async getNewsList() {
				let news = await this.$u.api.getNews()
				let newsList = news.data.map(item => {
					return {
						...item,
						cover: this.BaseFileURL + item.image.id
					}
				})

				this.newsList = [...this.newsList, ...newsList]
				console.log(this.newsList)
				this.swiperSliderNewsHeight = this.newsList.length * 95 + 100 + 'px'
				this.swiperSliderHeight = this.swiperSliderNewsHeight
			},
			// é¡µé¢æ»‘åŠ¨å·¦å³åˆ†é¡µçš„æ—¶å€™å®ç°çš„æ•ˆæœ
			swiperSlider(event) {
				if (event.detail.current === 0) {
					this.swiperSliderHeight = this.swiperSliderFeedsHeight
					uni.pageScrollTo({
						duration: 0, //è¿‡æ¸¡æ—¶é—´å¿…é¡»ä¸º0ï¼Œuniapp bugï¼Œå¦åˆ™è¿è¡Œåˆ°æ‰‹æœºä¼šæŠ¥é”™
						scrollTop: this.oldFeedsScrollTop, //æ»šåŠ¨åˆ°ç›®æ ‡ä½ç½®
					})
				} else {
					this.swiperSliderHeight = this.swiperSliderNewsHeight
					uni.pageScrollTo({
						duration: 0, //è¿‡æ¸¡æ—¶é—´å¿…é¡»ä¸º0ï¼Œuniapp bugï¼Œå¦åˆ™è¿è¡Œåˆ°æ‰‹æœºä¼šæŠ¥é”™
						scrollTop: this.oldNewsScrollTop, //æ»šåŠ¨åˆ°ç›®æ ‡ä½ç½®
					})
				}
				this.currentSwiperIndex = event.detail.current
			},
			// ç‚¹å‡»æŒ‰é’®å®ç°åˆ‡æ¢æ•ˆæœ
			swiperChange(index) {
				if (index === 0) {
					this.swiperSliderHeight = this.swiperSliderFeedsHeight
					uni.pageScrollTo({
						duration: 0, //è¿‡æ¸¡æ—¶é—´å¿…é¡»ä¸º0ï¼Œuniapp bugï¼Œå¦åˆ™è¿è¡Œåˆ°æ‰‹æœºä¼šæŠ¥é”™
						scrollTop: this.oldFeedsScrollTop, //æ»šåŠ¨åˆ°ç›®æ ‡ä½ç½®
					})
				} else {
					this.swiperSliderHeight = this.swiperSliderNewsHeight
					uni.pageScrollTo({
						duration: 0, //è¿‡æ¸¡æ—¶é—´å¿…é¡»ä¸º0ï¼Œuniapp bugï¼Œå¦åˆ™è¿è¡Œåˆ°æ‰‹æœºä¼šæŠ¥é”™
						scrollTop: this.oldNewsScrollTop, //æ»šåŠ¨åˆ°ç›®æ ‡ä½ç½®
					})
				}
				this.currentSwiperIndex = index
			},
			gotoFeeds(url) {
				uni.switchTab({
					url
				})
			}
		}
	}
</script>

<style lang="scss" scoped>
	#sns {
		background-color: #f1f1f1;
	}

	// æ¨èã€å’¨è¯¢ æŒ‰é’®æ ·å¼
	.tabs-box {
		display: flex;
		flex-direction: row;
		justify-content: center;
		width: 750upx;

		.one-nav {
			width: 120upx;
			color: #9B9B9B;
			font-size: 36upx;
			text-align: center;
			font-weight: blod;

			&.nav-actived {
				color: #0050FF;
			}
		}
	}

	.header-box {
		position: relative;
		left: 0;
		height: 500upx;
		background-color: #f1f1f1;
		z-index: 1;

		// å¹¿å‘Šä½è½®æ’­å™¨ç›¸å…³æ ·å¼
		.swiper {
			width: 750upx;
			height: 400upx;
			position: absolute;
			left: 0;
			top: 0;
			text-align: center;
			z-index: 1;

			.banner-swiper-img {
				width: 750upx;
				height: 400upx;
				box-shadow: 0 0 2px 0 rgb(188, 188, 188);
			}
		}

		.crile {
			width: 750upx;
			height: 50upx;
			position: absolute;
			left: 0;
			top: 355upx;
			z-index: 9;
		}

		// æ–°é²œäº‹ æ´»åŠ¨å¢™ æŒ‰é’®æ ·å¼
		.card-header {
			position: absolute;
			left: 0;
			top: 320upx;
			height: 160upx;
			z-index: 99;
			width: 710upx;
			margin-left: 20upx;
			display: flex;
			flex-direction: row;
			flex-wrap: wrap;
			justify-content: space-between;
			align-items: center;
			align-content: center;

			.card-one {
				width: 328upx;
				height: 96upx;
				border-radius: 49upx;
				background-color: #fff;
				margin: 0 10upx;
				box-shadow: 0 0 2px 0 rgb(188, 188, 188);
				display: flex;
				flex-direction: row;
				flex-wrap: wrap;
				justify-content: flex-start;
				align-items: center;
				align-content: center;

				.img {
					width: 44upx;
					height: 44upx;
					margin-left: 50upx;
				}

				.iright {
					margin-left: 30upx;
					text-align: left;
					color: #888;

					.title {
						font-size: 30upx;
						color: #001432;
					}

					.iview {
						display: flex;
						flex-direction: row;
						flex-wrap: wrap;
						justify-content: space-between;
						align-items: center;
						align-content: center;
						font-size: 20upx;
						margin-top: -5upx;
					}
				}
			}
		}

		// æ¨èã€å’¨è¯¢ æŒ‰é’®æ ·å¼
		.tabs-box {
			width: 750upx;
			position: absolute;
			z-index: 1;
			left: 0;
			top: 480upx;
			display: flex;
			flex-direction: row;
			justify-content: center;

			.one-nav {
				height: 80upx;
				width: 110upx;
				color: #9B9B9B;
				font-size: 36upx;
				text-align: center;
				font-weight: blod;

				&.nav-actived {
					color: #0050FF;
				}
			}
		}
	}

	// æ­¤åˆ» æ ç›®æ ·å¼\
	.swiper-box {
		background-color: #f1f1f1;
		padding: 60upx 0 40upx;
	}

	.sns-now {

		// åŠ¨æ€ç›¸å…³ç€‘å¸ƒæµæ ·å¼
		.feeds-box {
			width: 735upx;
			margin-left: 13upx;
			padding-bottom: 20upx;

			.feed-one {
				width: 358upx;
				margin-bottom: 12upx;
				background-color: #FFF;
				border-radius: 20upx;

				position: relative;

				.feed-img {
					width: 358upx;
					height: 300upx;
					border-radius: 10upx;
				}

				.feed-title {
					width: 350upx;
					margin-top: 15upx;
					margin-left: 10upx;
					font-size: 28upx;
					line-height: 40upx;
					color: #001432;
					text-align: left;
				}

				.feed-info {
					display: flex;
					flex-direction: row;
					flex-wrap: nowrap;
					justify-content: space-between;
					align-items: center;
					align-content: center;
					margin-top: 10upx;
					font-size: 20upx;
					color: #666;
					padding: 0 10upx 16upx;

					.iview {
						display: flex;
						flex-direction: row;
						flex-wrap: nowrap;
						justify-content: space-between;
						align-items: center;
						align-content: center;

						.ilike {
							display: flex;
							flex-direction: row;
							flex-wrap: nowrap;
							justify-content: space-between;
							align-items: center;
							align-content: center;
							height: 60upx;
							padding: 0 10upx;
							background-color: #FFFFFF;
						}
					}

					.avatar {
						margin-right: 10upx;
						height: 40upx;
						width: 40upx;
						border-radius: 50%;
						border: 1upx solid #eee;
					}

					.name {
						max-width: 120upx;
						color: #757474;
					}

					.micon {
						width: 32upx;
						height: 28upx;
					}

					.love-count {
						padding-left: 10upx;
						color: #757474;
					}
				}
			}
		}
	}

	// è½®æ’­é¡µé¢ èµ„è®¯
	.sns-news {
		background-color: #fff;
		width: 750upx;

		.one-new {
			width: 700upx;
			height: 74px;
			display: flex;
			flex-direction: row;
			flex-wrap: wrap;
			justify-content: space-around;
			align-items: flex-start;
			align-content: center;
			padding-bottom: 10px;
			padding-top: 10px;
			padding-left: 25upx;
			padding-right: 25upx;
			border-bottom: 1px solid #f1f1f1;

			.left {
				width: 490upx;
				height: 140upx;
				text-align: left;
				display: flex;
				flex-direction: column;
				justify-content: space-between;
				align-items: flex-start;

				.title {
					font-size: 30upx;
					line-height: 42upx;
					color: #001432;
					margin-top: 21upx;
				}

				.uinfo {
					width: 490upx;
					display: flex;
					flex-direction: row;
					flex-wrap: nowrap;
					justify-content: space-between;
					align-items: center;
					align-content: center;
					margin-top: 6upx;
					font-size: 20upx;
					color: #999;

					.utime {
						font-size: 24upx;

						.name {
							max-width: 120upx;
							color: #777;
						}
					}
				}
			}

			.right {
				width: 120upx;

				.pic {
					width: 120upx;
					height: 120upx;
					margin-top: 20upx;
					border-radius: 6upx;
				}
			}
		}
	}
</style>

```